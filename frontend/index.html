<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistem Parkir - Admin</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: Arial, sans-serif;
        }
        
        body {
            background: #f0f2f5;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        /* Header & Login */
        .header {
            background: #2c3e50;
            color: white;
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .login-form {
            display: flex;
            gap: 10px;
            align-items: center;
        }
        
        .login-form input {
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
        }
        
        .btn-login {
            background: #27ae60;
            color: white;
            padding: 8px 15px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        
        .btn-logout {
            background: #e74c3c;
            color: white;
            padding: 8px 15px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        
        .user-info {
            color: white;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        /* Tabs */
        .tabs {
            display: flex;
            background: #34495e;
        }
        
        .tab {
            padding: 15px 25px;
            color: white;
            cursor: pointer;
            border: none;
            background: none;
            font-size: 16px;
        }
        
        .tab.active {
            background: #3498db;
        }
        
        .tab-content {
            display: none;
            padding: 20px;
        }
        
        .tab-content.active {
            display: block;
        }
        
        /* Form Styles */
        .form-group {
            margin-bottom: 15px;
        }
        
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #333;
        }
        
        input, select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
        }
        
        button {
            background: #3498db;
            color: white;
            padding: 12px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
        }
        
        button:hover {
            background: #2980b9;
        }
        
        /* Table Styles */
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        
        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }
        
        th {
            background: #f8f9fa;
            font-weight: bold;
        }
        
        .actions {
            display: flex;
            gap: 5px;
        }
        
        .btn-hapus {
            background: #e74c3c;
            padding: 5px 10px;
            font-size: 14px;
        }
        
        .btn-bayar {
            background: #27ae60;
            padding: 5px 10px;
            font-size: 14px;
        }
        
        .status {
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: bold;
        }
        
        .status-aktif {
            background: #d4edda;
            color: #155724;
        }
        
        .status-selesai {
            background: #cce7ff;
            color: #004085;
        }
        
        /* Dashboard Stats */
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            text-align: center;
        }
        
        .stat-card h3 {
            font-size: 2em;
            color: #2c3e50;
            margin-bottom: 5px;
        }
        
        .alert {
            padding: 15px;
            margin: 10px 0;
            border-radius: 5px;
            display: none;
        }
        
        .alert-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .alert-error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header & Login -->
        <div class="header">
            <h1>üöó Sistem Parkir Admin</h1>
            <div id="login-section">
                <div class="login-form" id="login-form">
                    <input type="text" id="username" placeholder="Username" value="admin">
                    <input type="password" id="password" placeholder="Password" value="admin123">
                    <button class="btn-login" onclick="login()">Login</button>
                </div>
                <div class="user-info" id="user-info" style="display: none;">
                    <span>Halo, Admin</span>
                    <button class="btn-logout" onclick="logout()">Logout</button>
                </div>
            </div>
        </div>

        <!-- Alert Messages -->
        <div id="alert-container"></div>

        <!-- Tabs Navigation -->
        <div class="tabs">
            <button class="tab active" onclick="openTab('dashboard')">üìä Dashboard</button>
            <button class="tab" onclick="openTab('parkir')">üöó Parkir</button>
            <button class="tab" onclick="openTab('riwayat')">üìã Riwayat</button>
            <button class="tab" onclick="openTab('laporan')">üìà Laporan</button>
        </div>

        <!-- Dashboard Tab -->
        <div id="dashboard" class="tab-content active">
            <h2>Dashboard</h2>
            
            <div class="stats">
                <div class="stat-card">
                    <h3 id="total-parkir">0</h3>
                    <p>Kendaraan Parkir</p>
                </div>
                <div class="stat-card">
                    <h3 id="total-pendapatan">Rp 0</h3>
                    <p>Pendapatan Hari Ini</p>
                </div>
                <div class="stat-card">
                    <h3 id="total-transaksi">0</h3>
                    <p>Total Transaksi</p>
                </div>
                <div class="stat-card">
                    <h3 id="slot-tersedia">50</h3>
                    <p>Slot Tersedia</p>
                </div>
            </div>

            <div class="form-group">
                <h3>Tambah Kendaraan Manual</h3>
                <input type="text" id="plat-nomor" placeholder="Plat Nomor (B 1234 ABC)" style="margin-bottom: 10px;">
                <select id="jenis-kendaraan" style="margin-bottom: 10px;">
                    <option value="">Pilih Jenis Kendaraan</option>
                    <option value="mobil">Mobil</option>
                    <option value="motor">Motor</option>
                </select>
                <button onclick="tambahKendaraan()" style="width: 100%;">‚ûï Tambah Kendaraan</button>
            </div>
        </div>

        <!-- Parkir Tab -->
        <div id="parkir" class="tab-content">
            <h2>Kendaraan Sedang Parkir</h2>
            <table>
                <thead>
                    <tr>
                        <th>No</th>
                        <th>Plat Nomor</th>
                        <th>Jenis</th>
                        <th>Waktu Masuk</th>
                        <th>Durasi</th>
                        <th>Biaya</th>
                        <th>Status</th>
                        <th>Aksi</th>
                    </tr>
                </thead>
                <tbody id="daftar-parkir">
                    <tr>
                        <td colspan="8" style="text-align: center;">Silakan login terlebih dahulu</td>
                    </tr>
                </tbody>
            </table>
        </div>

        <!-- Riwayat Tab -->
        <div id="riwayat" class="tab-content">
            <h2>Riwayat Pembayaran</h2>
            <table>
                <thead>
                    <tr>
                        <th>No</th>
                        <th>Plat Nomor</th>
                        <th>Waktu Masuk</th>
                        <th>Waktu Keluar</th>
                        <th>Durasi</th>
                        <th>Total Biaya</th>
                    </tr>
                </thead>
                <tbody id="riwayat-pembayaran">
                    <tr>
                        <td colspan="6" style="text-align: center;">Silakan login terlebih dahulu</td>
                    </tr>
                </tbody>
            </table>
        </div>

        <!-- Laporan Tab -->
        <div id="laporan" class="tab-content">
            <h2>Laporan Harian</h2>
            <div class="stats">
                <div class="stat-card">
                    <h3 id="laporan-pendapatan">Rp 0</h3>
                    <p>Total Pendapatan</p>
                </div>
                <div class="stat-card">
                    <h3 id="laporan-transaksi">0</h3>
                    <p>Total Transaksi</p>
                </div>
                <div class="stat-card">
                    <h3 id="laporan-mobil">0</h3>
                    <p>Kendaraan Mobil</p>
                </div>
                <div class="stat-card">
                    <h3 id="laporan-motor">0</h3>
                    <p>Kendaraan Motor</p>
                </div>
            </div>

            <button onclick="exportLaporan()" style="margin-bottom: 20px;">üìÑ Export Laporan</button>
            <button onclick="resetData()" style="background: #e74c3c; margin-left: 10px;">üîÑ Reset Data</button>
        </div>
    </div>

    <script>
        // ==================== KONFIGURASI ====================
        const ADMIN_USERNAME = "admin";
        const ADMIN_PASSWORD = "admin123";
        const TARIF_PARKIR = {
            'mobil': 5000,
            'motor': 2000
        };
        
        // ==================== STATE MANAGEMENT ====================
        let isLoggedIn = localStorage.getItem('isLoggedIn') === 'true';
        let dataParkir = JSON.parse(localStorage.getItem('dataParkir')) || [];
        let riwayatPembayaran = JSON.parse(localStorage.getItem('riwayatPembayaran')) || [];

        // ==================== AUTHENTICATION ====================
        function login() {
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            
            if (username === ADMIN_USERNAME && password === ADMIN_PASSWORD) {
                isLoggedIn = true;
                localStorage.setItem('isLoggedIn', 'true');
                updateUI();
                showAlert('Login berhasil!', 'success');
            } else {
                showAlert('Username atau password salah!', 'error');
            }
        }
        
        function logout() {
            isLoggedIn = false;
            localStorage.setItem('isLoggedIn', 'false');
            updateUI();
            showAlert('Logout berhasil!', 'success');
        }
        
        function updateUI() {
            const loginForm = document.getElementById('login-form');
            const userInfo = document.getElementById('user-info');
            
            if (isLoggedIn) {
                loginForm.style.display = 'none';
                userInfo.style.display = 'flex';
                loadData();
            } else {
                loginForm.style.display = 'flex';
                userInfo.style.display = 'none';
                clearData();
            }
        }

        // ==================== TAB MANAGEMENT ====================
        function openTab(tabName) {
            if (!isLoggedIn) {
                showAlert('Silakan login terlebih dahulu!', 'error');
                return;
            }
            
            // Sembunyikan semua tab content
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Non-aktifkan semua tab buttons
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Aktifkan tab yang dipilih
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');
            
            // Refresh data tab yang dipilih
            if (tabName === 'dashboard') {
                updateDashboard();
            } else if (tabName === 'parkir') {
                tampilkanDataParkir();
            } else if (tabName === 'riwayat') {
                tampilkanRiwayat();
            } else if (tabName === 'laporan') {
                updateLaporan();
            }
        }

        // ==================== CORE FUNCTIONS ====================
        function tambahKendaraan() {
            if (!isLoggedIn) {
                showAlert('Silakan login terlebih dahulu!', 'error');
                return;
            }
            
            const platNomor = document.getElementById('plat-nomor').value;
            const jenis = document.getElementById('jenis-kendaraan').value;
            
            if (!platNomor || !jenis) {
                showAlert('Harap isi semua field!', 'error');
                return;
            }
            
            // Cek apakah kendaraan sudah parkir
            const sudahParkir = dataParkir.find(k => k.platNomor === platNomor && !k.waktuKeluar);
            if (sudahParkir) {
                showAlert('Kendaraan ini masih parkir!', 'error');
                return;
            }
            
            // Tambah data baru
            const kendaraanBaru = {
                id: Date.now(),
                platNomor: platNomor,
                jenis: jenis,
                waktuMasuk: new Date(),
                waktuKeluar: null,
                biaya: 0
            };
            
            dataParkir.push(kendaraanBaru);
            simpanData();
            updateDashboard();
            tampilkanDataParkir();
            
            // Reset form
            document.getElementById('plat-nomor').value = '';
            document.getElementById('jenis-kendaraan').value = '';
            
            showAlert('Kendaraan berhasil ditambahkan!', 'success');
        }
        
        function bayarParkir(id) {
            const kendaraan = dataParkir.find(k => k.id === id);
            
            if (!kendaraan) {
                showAlert('Data kendaraan tidak ditemukan!', 'error');
                return;
            }
            
            const biaya = hitungBiaya(kendaraan.waktuMasuk, kendaraan.jenis);
            const durasi = Math.ceil((new Date() - new Date(kendaraan.waktuMasuk)) / (1000 * 60 * 60));
            
            if (confirm(`Plat: ${kendaraan.platNomor}\nDurasi: ${durasi} jam\nTotal Bayar: Rp ${biaya.toLocaleString()}\n\nLanjutkan pembayaran?`)) {
                // Update data parkir
                kendaraan.waktuKeluar = new Date();
                kendaraan.biaya = biaya;
                
                // Tambah ke riwayat
                riwayatPembayaran.push({
                    platNomor: kendaraan.platNomor,
                    waktuMasuk: kendaraan.waktuMasuk,
                    waktuKeluar: kendaraan.waktuKeluar,
                    durasi: durasi,
                    totalBiaya: biaya,
                    jenis: kendaraan.jenis
                });
                
                simpanData();
                updateDashboard();
                tampilkanDataParkir();
                tampilkanRiwayat();
                updateLaporan();
                
                showAlert(`Pembayaran berhasil! Total: Rp ${biaya.toLocaleString()}`, 'success');
            }
        }
        
        function hapusKendaraan(id) {
            if (confirm('Apakah Anda yakin ingin menghapus kendaraan ini?')) {
                dataParkir = dataParkir.filter(k => k.id !== id);
                simpanData();
                tampilkanDataParkir();
                updateDashboard();
                showAlert('Kendaraan berhasil dihapus!', 'success');
            }
        }
        
        function hitungBiaya(waktuMasuk, jenis) {
            const sekarang = new Date();
            const selisih = sekarang - new Date(waktuMasuk);
            const jam = Math.ceil(selisih / (1000 * 60 * 60));
            return jam * TARIF_PARKIR[jenis];
        }

        // ==================== DATA DISPLAY ====================
        function tampilkanDataParkir() {
            const daftarParkir = document.getElementById('daftar-parkir');
            const kendaraanAktif = dataParkir.filter(k => !k.waktuKeluar);
            
            if (kendaraanAktif.length === 0) {
                daftarParkir.innerHTML = '<tr><td colspan="8" style="text-align: center;">Tidak ada kendaraan parkir</td></tr>';
            } else {
                let html = '';
                kendaraanAktif.forEach((k, index) => {
                    const durasi = Math.ceil((new Date() - new Date(k.waktuMasuk)) / (1000 * 60 * 60));
                    const biayaSementara = durasi * TARIF_PARKIR[k.jenis];
                    
                    html += `
                        <tr>
                            <td>${index + 1}</td>
                            <td><strong>${k.platNomor}</strong></td>
                            <td>${k.jenis}</td>
                            <td>${new Date(k.waktuMasuk).toLocaleString('id-ID')}</td>
                            <td>${durasi} jam</td>
                            <td>Rp ${biayaSementara.toLocaleString()}</td>
                            <td><span class="status status-aktif">Parkir</span></td>
                            <td class="actions">
                                <button class="btn-bayar" onclick="bayarParkir(${k.id})">üí≥ Bayar</button>
                                <button class="btn-hapus" onclick="hapusKendaraan(${k.id})">üóëÔ∏è Hapus</button>
                            </td>
                        </tr>
                    `;
                });
                daftarParkir.innerHTML = html;
            }
        }
        
        function tampilkanRiwayat() {
            const riwayatElement = document.getElementById('riwayat-pembayaran');
            
            if (riwayatPembayaran.length === 0) {
                riwayatElement.innerHTML = '<tr><td colspan="6" style="text-align: center;">Belum ada riwayat pembayaran</td></tr>';
            } else {
                let html = '';
                riwayatPembayaran.slice().reverse().forEach((r, index) => {
                    html += `
                        <tr>
                            <td>${index + 1}</td>
                            <td><strong>${r.platNomor}</strong></td>
                            <td>${new Date(r.waktuMasuk).toLocaleString('id-ID')}</td>
                            <td>${new Date(r.waktuKeluar).toLocaleString('id-ID')}</td>
                            <td>${r.durasi} jam</td>
                            <td><strong>Rp ${r.totalBiaya.toLocaleString()}</strong></td>
                        </tr>
                    `;
                });
                riwayatElement.innerHTML = html;
            }
        }
        
        function updateDashboard() {
            const kendaraanAktif = dataParkir.filter(k => !k.waktuKeluar);
            const pendapatanHariIni = hitungPendapatanHariIni();
            const totalTransaksi = riwayatPembayaran.length;
            const slotTersedia = 50 - kendaraanAktif.length;
            
            document.getElementById('total-parkir').textContent = kendaraanAktif.length;
            document.getElementById('total-pendapatan').textContent = `Rp ${pendapatanHariIni.toLocaleString()}`;
            document.getElementById('total-transaksi').textContent = totalTransaksi;
            document.getElementById('slot-tersedia').textContent = slotTersedia;
        }
        
        function updateLaporan() {
            const totalPendapatan = riwayatPembayaran.reduce((sum, r) => sum + r.totalBiaya, 0);
            const totalTransaksi = riwayatPembayaran.length;
            const kendaraanMobil = riwayatPembayaran.filter(r => r.jenis === 'mobil').length;
            const kendaraanMotor = riwayatPembayaran.filter(r => r.jenis === 'motor').length;
            
            document.getElementById('laporan-pendapatan').textContent = `Rp ${totalPendapatan.toLocaleString()}`;
            document.getElementById('laporan-transaksi').textContent = totalTransaksi;
            document.getElementById('laporan-mobil').textContent = kendaraanMobil;
            document.getElementById('laporan-motor').textContent = kendaraanMotor;
        }
        
        function hitungPendapatanHariIni() {
            const hariIni = new Date().toDateString();
            return riwayatPembayaran
                .filter(r => new Date(r.waktuKeluar).toDateString() === hariIni)
                .reduce((sum, r) => sum + r.totalBiaya, 0);
        }

        // ==================== UTILITY FUNCTIONS ====================
        function simpanData() {
            localStorage.setItem('dataParkir', JSON.stringify(dataParkir));
            localStorage.setItem('riwayatPembayaran', JSON.stringify(riwayatPembayaran));
        }
        
        function loadData() {
            updateDashboard();
            tampilkanDataParkir();
            tampilkanRiwayat();
            updateLaporan();
        }
        
        function clearData() {
            document.getElementById('daftar-parkir').innerHTML = 
                '<tr><td colspan="8" style="text-align: center;">Silakan login terlebih dahulu</td></tr>';
            document.getElementById('riwayat-pembayaran').innerHTML = 
                '<tr><td colspan="6" style="text-align: center;">Silakan login terlebih dahulu</td></tr>';
        }
        
        function showAlert(message, type) {
            const alertContainer = document.getElementById('alert-container');
            const alertId = 'alert-' + Date.now();
            
            const alertHTML = `
                <div id="${alertId}" class="alert alert-${type}">
                    ${message}
                </div>
            `;
            
            alertContainer.innerHTML = alertHTML;
            
            // Tampilkan alert
            const alertElement = document.getElementById(alertId);
            alertElement.style.display = 'block';
            
            // Sembunyikan setelah 5 detik
            setTimeout(() => {
                alertElement.style.display = 'none';
            }, 5000);
        }
        
        function exportLaporan() {
            const laporan = {
                totalPendapatan: riwayatPembayaran.reduce((sum, r) => sum + r.totalBiaya, 0),
                totalTransaksi: riwayatPembayaran.length,
                kendaraanMobil: riwayatPembayaran.filter(r => r.jenis === 'mobil').length,
                kendaraanMotor: riwayatPembayaran.filter(r => r.jenis === 'motor').length,
                riwayat: riwayatPembayaran
            };
            
            const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(laporan, null, 2));
            const downloadAnchor = document.createElement('a');
            downloadAnchor.setAttribute("href", dataStr);
            downloadAnchor.setAttribute("download", "laporan_parkir.json");
            document.body.appendChild(downloadAnchor);
            downloadAnchor.click();
            downloadAnchor.remove();
            
            showAlert('Laporan berhasil diexport!', 'success');
        }
        
        function resetData() {
            if (confirm('Apakah Anda yakin ingin menghapus semua data? Tindakan ini tidak dapat dibatalkan!')) {
                localStorage.clear();
                dataParkir = [];
                riwayatPembayaran = [];
                simpanData();
                loadData();
                showAlert('Semua data berhasil direset!', 'success');
            }
        }

        // ==================== INITIALIZATION ====================
        document.addEventListener('DOMContentLoaded', function() {
            updateUI();
            
            // Enter key untuk form login
            document.getElementById('username').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') login();
            });
            
            document.getElementById('password').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') login();
            });
            
            // Enter key untuk form tambah kendaraan
            document.getElementById('plat-nomor').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') tambahKendaraan();
            });
            
            document.getElementById('jenis-kendaraan').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') tambahKendaraan();
            });
        });
    </script>
</body>
</html>